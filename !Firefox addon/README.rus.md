# Версия для браузера Firefox в формате аддона

Теперь и пользовательским интерфейсом, возможностью сохранять и загружать списки тегов и папок, и все это без флэша.

## Установка

Пока [версия на AMO](https://addons.mozilla.org/en-US/firefox/addon/tumblr-image-sorter/) не пройдет проверку, можно скачивать .xpi файл из репозитория здесь и устанавливать перетаскиванием на окно браузера. Учтите, что начиная с версии 41, Firefox отказывается запускать неподписанные аддоны, поэтому при таком методе установки понадобится зайти в настройки about:config#xpinstall.signatures.required и установить этот параметр в false.

## Описание GUI

После установки (перезапуск не требуется) значок аддона появится справа на панели браузера, либо в меню.
  ![http://puu.sh/jZy8f/8bfddda662.png](http://puu.sh/jZy8f/8bfddda662.png)  
  
Эта кнопка открывает окно настроек, позволяющее ввести необходимые для работы [данные](https://github.com/Seedmanc/Tumblr-image-sorter/blob/master/README.rus.md#%D0%9D%D0%B5%D0%BE%D0%B1%D1%85%D0%BE%D0%B4%D0%B8%D0%BC%D1%8B%D0%B5-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5).

### Списки

В их числе - игнорлист, список сопоставления тегов и папок, списки имен и метатегов. Они могут быть загружены из файла в формате JSON.

![http://puu.sh/jZz0Z/fa7d1ea701.png](http://puu.sh/jZz0Z/fa7d1ea701.png)

Аддон производит проверку вводимых данных по следующим правилам:

|Поле ввода  |Правила| Обработка ошибок | 
|:-:          |---  |---              |
|Ignore|Слова, разделенные запятыми|Лишние пробелы и запятые удаляются|
|Root| Полный путь к папке, включая букву диска |Выделяется красным, ввод пропускается|  
|Metasymbol|Допустимые для имен файлов символы кроме пробела| Выделяется оранжевым, заменяется на '!'|
|Folders левая часть| Любые символы кроме запятых, не пустое| Выделяется оранжевым, запятые удаляются. Пустое выделяется красным, вся строка пропускается |
|Folders правая часть|Допустимые для имен файлов символы (включая обратную косую черту), не пустое|Выделяется оранжевым, недопустимые символы заменяются на дефис. Пустое выделяется красным, вся строка пропускается|
|Name и meta левая часть|Как в folders|Как в folders|
|Name и meta правая часть|Как в folders (исключая обратную косую черту)|Как в folders|

Иначе говоря, только корневая папка и три специальные подпапки для сольных, групповых и нераспознанных фото являются обязательными для заполнения и будут отмечены красным цветом в случае ошибок. В остальных случаях аддон будет автоматически исправлять ошибки, выделяя измененные поля оранжевым цветом.

### Загрузка и сохранение списков.

Аддон позволяет экспортировать и импортировать списки папок (включая корневую папку и метасимвол) и списки имен/метатегов. Вышеописанные методы проверки корректности применяются и в этом случае.

При загрузке пользователю будет предложено выбрать режим импорта - добавление или замена данных. При добавлении существующие  записи не изменяются, при замене выбранная база данных очищается.

  Содержимое файла представляет собой яваскрипт-объект в JSON-строковом формате. Такие файлы можно редактировать перед импортом (я рекомендую использовать редактор получше просто блокнота). Вы можете использовать мои базы данных папок и тегов как пример: [folders.json.txt](https://github.com/Seedmanc/Tumblr-image-sorter/blob/master/!Firefox%20addon/folders.json.txt), [names & meta.json.txt](https://github.com/Seedmanc/Tumblr-image-sorter/blob/master/names%20%26%20meta.json.txt). Учтите, что они довольно велики, более 250 записей в сумме.

### Настройки

![http://puu.sh/jZAhH/ba639a2632.png](http://puu.sh/jZAhH/ba639a2632.png)

Первая панель содержит настройки для страниц с постами. Здесь можно выбрать цвет рамки, которой выделяются сохраненные картинки, отключить запуск скрипта в ленте и обработку вложенных изображений, разрешить использование символов юникода при вводе переводов тегов вручную и отключить автоматическое расширение базы данных папок за счет использования имен папок как тегов.

### Об аддоне

![http://puu.sh/jZAjg/d5417807df.png](http://puu.sh/jZAjg/d5417807df.png)

Здесь находится кнопка сброса, очищающая все базы данных аддона.

### Совместимость

На данный момент аддон-версия является прямым портом юзерскрипта и не содержит каких-либо значительных нововведение (если не считать самого интерфейса). Существующие ограничения действуют и здесь.

Нет поддержки тем с бесконечной прокруткой. Можно использовать аддон, отключающий ее http://addons.mozilla.org/en-US/firefox/addon/anti-tumblr-infinite-scroll/ .

Нет поддержки тем с Wikplayer'ом. Похоже, что он оборачивает всю страницу в iframe, находящийся на другом хостинге.

Смотрите [раздел основного readme](https://github.com/Seedmanc/Tumblr-image-sorter/blob/master/README.rus.md#%D0%A1%D0%BE%D0%B2%D0%BC%D0%B5%D1%81%D1%82%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D1%8C), чтобы получить больше информаии о совместимости.

### TODO для этой версии

* Открывать диалог сохранения напрямую в определенной папке, чтобы не использовать буфер обмена
* Добавить возможность чтения результатов команды `dir /s/b/o:n/A:D > folders.txt` для быстрого заполнения правой части списка папок.
